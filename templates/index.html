<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FC Z√ºrich Stats - Saison {{ stats.season }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">‚öΩ</span>
                    <h1>{{ stats.team_name }}</h1>
                </div>
                <div class="league-info">
                    <span class="league">{{ stats.league }}</span>
                    <span class="season">Saison {{ stats.season }}</span>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Quick Stats Cards -->
        <section class="stats-overview">
            <div class="stat-card position">
                <div class="stat-value">{{ stats.position or '-' }}</div>
                <div class="stat-label">Tabellenplatz</div>
            </div>
            <div class="stat-card points">
                <div class="stat-value">{{ stats.points }}</div>
                <div class="stat-label">Punkte</div>
            </div>
            <div class="stat-card wins">
                <div class="stat-value">{{ stats.won }}</div>
                <div class="stat-label">Siege</div>
            </div>
            <div class="stat-card draws">
                <div class="stat-value">{{ stats.drawn }}</div>
                <div class="stat-label">Unentschieden</div>
            </div>
            <div class="stat-card losses">
                <div class="stat-value">{{ stats.lost }}</div>
                <div class="stat-label">Niederlagen</div>
            </div>
        </section>

        <!-- Additional Stats Cards -->
        {% if stats.clean_sheets is defined %}
        <section class="stats-overview additional-stats">
            <div class="stat-card">
                <div class="stat-value">{{ stats.clean_sheets }}</div>
                <div class="stat-label">Zu-Null-Spiele</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ "%.2f"|format(stats.avg_goals_per_match) }}</div>
                <div class="stat-label">‚åÄ Tore/Spiel</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ "%.2f"|format(stats.avg_conceded_per_match) }}</div>
                <div class="stat-label">‚åÄ Gegentore/Spiel</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.win_percentage }}%</div>
                <div class="stat-label">Siegquote</div>
            </div>
        </section>
        {% endif %}

        <!-- Charts Section -->
        <section class="charts-section">
            <h2>üìä Saison-Diagramme</h2>
            <div class="charts-grid">
                <!-- Points Progression Chart -->
                <div class="chart-card">
                    <h3>Punkteverlauf</h3>
                    <canvas id="pointsChart"></canvas>
                </div>
                
                <!-- Win/Draw/Loss Pie Chart -->
                <div class="chart-card">
                    <h3>Spielergebnisse</h3>
                    <canvas id="resultsChart"></canvas>
                </div>
                
                <!-- Goals Chart -->
                <div class="chart-card">
                    <h3>Tore pro Spieltag</h3>
                    <canvas id="goalsChart"></canvas>
                </div>
                
                <!-- Home vs Away Chart -->
                <div class="chart-card">
                    <h3>Heim vs. Ausw√§rts</h3>
                    <canvas id="homeAwayChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Goals Section -->
        <section class="goals-section">
            <h2>Tore</h2>
            <div class="goals-grid">
                <div class="goal-card">
                    <div class="goal-value for">{{ stats.goals_for }}</div>
                    <div class="goal-label">Geschossen</div>
                </div>
                <div class="goal-card">
                    <div class="goal-value against">{{ stats.goals_against }}</div>
                    <div class="goal-label">Kassiert</div>
                </div>
                <div class="goal-card">
                    <div class="goal-value diff {% if stats.goal_difference > 0 %}positive{% elif stats.goal_difference < 0 %}negative{% endif %}">
                        {% if stats.goal_difference > 0 %}+{% endif %}{{ stats.goal_difference }}
                    </div>
                    <div class="goal-label">Tordifferenz</div>
                </div>
            </div>
        </section>

        <!-- Home vs Away Stats -->
        {% if stats.home_stats and stats.away_stats %}
        <section class="home-away-section">
            <h2>üè† Heim vs. üöó Ausw√§rts</h2>
            <div class="home-away-grid">
                <div class="location-card home">
                    <h3>üè† Heimspiele</h3>
                    <div class="location-stats">
                        <div class="location-stat">
                            <span class="stat-num">{{ stats.home_stats.played }}</span>
                            <span class="stat-txt">Spiele</span>
                        </div>
                        <div class="location-stat">
                            <span class="stat-num success">{{ stats.home_stats.won }}</span>
                            <span class="stat-txt">Siege</span>
                        </div>
                        <div class="location-stat">
                            <span class="stat-num warning">{{ stats.home_stats.drawn }}</span>
                            <span class="stat-txt">Remis</span>
                        </div>
                        <div class="location-stat">
                            <span class="stat-num danger">{{ stats.home_stats.lost }}</span>
                            <span class="stat-txt">Niederl.</span>
                        </div>
                        <div class="location-stat">
                            <span class="stat-num">{{ stats.home_stats.goals_for }}:{{ stats.home_stats.goals_against }}</span>
                            <span class="stat-txt">Tore</span>
                        </div>
                        <div class="location-stat">
                            <span class="stat-num highlight">{{ stats.home_stats.points }}</span>
                            <span class="stat-txt">Punkte</span>
                        </div>
                    </div>
                </div>
                <div class="location-card away">
                    <h3>üöó Ausw√§rtsspiele</h3>
                    <div class="location-stats">
                        <div class="location-stat">
                            <span class="stat-num">{{ stats.away_stats.played }}</span>
                            <span class="stat-txt">Spiele</span>
                        </div>
                        <div class="location-stat">
                            <span class="stat-num success">{{ stats.away_stats.won }}</span>
                            <span class="stat-txt">Siege</span>
                        </div>
                        <div class="location-stat">
                            <span class="stat-num warning">{{ stats.away_stats.drawn }}</span>
                            <span class="stat-txt">Remis</span>
                        </div>
                        <div class="location-stat">
                            <span class="stat-num danger">{{ stats.away_stats.lost }}</span>
                            <span class="stat-txt">Niederl.</span>
                        </div>
                        <div class="location-stat">
                            <span class="stat-num">{{ stats.away_stats.goals_for }}:{{ stats.away_stats.goals_against }}</span>
                            <span class="stat-txt">Tore</span>
                        </div>
                        <div class="location-stat">
                            <span class="stat-num highlight">{{ stats.away_stats.points }}</span>
                            <span class="stat-txt">Punkte</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Monthly Statistics Table -->
        {% if stats.monthly_stats %}
        <section class="monthly-section">
            <h2>üìÖ Monatliche Statistik</h2>
            <div class="table-wrapper">
                <table class="monthly-table">
                    <thead>
                        <tr>
                            <th>Monat</th>
                            <th>Sp</th>
                            <th>S</th>
                            <th>U</th>
                            <th>N</th>
                            <th>Tore</th>
                            <th>Pkt</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for month in stats.monthly_stats %}
                        <tr>
                            <td class="month-name">{{ month.month }}</td>
                            <td>{{ month.played }}</td>
                            <td class="won">{{ month.won }}</td>
                            <td class="drawn">{{ month.drawn }}</td>
                            <td class="lost">{{ month.lost }}</td>
                            <td>{{ month.goals_for }}:{{ month.goals_against }}</td>
                            <td class="points">{{ month.points }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% endif %}

        <!-- Top Scorers Section -->
        {% if stats.top_scorers %}
        <section class="scorers-section">
            <h2>‚öΩ Torsch√ºtzen</h2>
            <div class="scorers-list">
                {% for scorer in stats.top_scorers %}
                <div class="scorer-card">
                    <div class="scorer-rank">{{ loop.index }}</div>
                    <div class="scorer-info">
                        <div class="scorer-name">{{ scorer.name }}</div>
                        <div class="scorer-stats">
                            <span class="goals">{{ scorer.goals }} Tore</span>
                            <span class="assists">{{ scorer.assists }} Assists</span>
                        </div>
                    </div>
                    <div class="scorer-total">{{ scorer.goals + scorer.assists }}</div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Next Match Section -->
        {% if stats.next_match %}
        <section class="next-match-section">
            <h2>N√§chstes Spiel</h2>
            <div class="match-card">
                <div class="match-competition">{{ stats.next_match.competition }}</div>
                <div class="match-teams">
                    <div class="team home {% if 'Z√ºrich' in stats.next_match.home_team %}fcz{% endif %}">
                        {{ stats.next_match.home_team }}
                    </div>
                    <div class="vs">vs</div>
                    <div class="team away {% if 'Z√ºrich' in stats.next_match.away_team %}fcz{% endif %}">
                        {{ stats.next_match.away_team }}
                    </div>
                </div>
                <div class="match-details">
                    <div class="match-date">üìÖ {{ format_date(stats.next_match.date) }}</div>
                    {% if stats.next_match.venue %}
                    <div class="match-venue">üìç {{ stats.next_match.venue }}</div>
                    {% endif %}
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Recent Form Section -->
        {% if stats.recent_matches %}
        <section class="recent-form-section">
            <h2>Letzte Spiele</h2>
            <div class="form-badges">
                {% for result in stats.form_last_5 %}
                <span class="form-badge {{ result|lower }}">{{ result }}</span>
                {% endfor %}
            </div>
            <div class="recent-matches">
                {% for match in stats.recent_matches %}
                <div class="recent-match">
                    <span class="result-badge {{ match.result|lower }}">{{ match.result }}</span>
                    <span class="opponent">{{ match.opponent }}</span>
                    <span class="score">{{ match.score }}</span>
                    <span class="date">{{ match.date }}</span>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- League Table Section -->
        <section class="table-section">
            <h2>Tabelle</h2>
            <div class="table-wrapper">
                <table class="league-table">
                    <thead>
                        <tr>
                            <th class="pos">#</th>
                            <th class="team">Team</th>
                            <th class="played">Sp</th>
                            <th class="won">S</th>
                            <th class="drawn">U</th>
                            <th class="lost">N</th>
                            <th class="gf">T+</th>
                            <th class="ga">T-</th>
                            <th class="gd">TD</th>
                            <th class="points">Pkt</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for team in stats.standings %}
                        <tr class="{% if 'Z√ºrich' in team.team.name %}highlight{% endif %}">
                            <td class="pos">{{ team.position }}</td>
                            <td class="team">{{ team.team.name }}</td>
                            <td class="played">{{ team.playedGames }}</td>
                            <td class="won">{{ team.won }}</td>
                            <td class="drawn">{{ team.draw }}</td>
                            <td class="lost">{{ team.lost }}</td>
                            <td class="gf">{{ team.goalsFor }}</td>
                            <td class="ga">{{ team.goalsAgainst }}</td>
                            <td class="gd">{% if team.goalDifference > 0 %}+{% endif %}{{ team.goalDifference }}</td>
                            <td class="points">{{ team.points }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>FC Z√ºrich Stats Dashboard | Saison {{ stats.season }} | Daten werden regelm√§ssig aktualisiert</p>
            <p class="disclaimer">Inoffizielle Statistik-Seite</p>
        </div>
    </footer>

    <script>
        // Chart.js Configuration
        const fczBlue = '#0066b3';
        const fczBlueDark = '#004d86';
        const successColor = '#00b894';
        const warningColor = '#fdcb6e';
        const dangerColor = '#d63031';

        // Points Progression Chart
        const pointsCtx = document.getElementById('pointsChart').getContext('2d');
        new Chart(pointsCtx, {
            type: 'line',
            data: {
                labels: {{ range(1, stats.points_progression|length + 1)|list|tojson if stats.points_progression else '[]' }},
                datasets: [{
                    label: 'Punkte',
                    data: {{ stats.points_progression|tojson if stats.points_progression else '[]' }},
                    borderColor: fczBlue,
                    backgroundColor: 'rgba(0, 102, 179, 0.1)',
                    fill: true,
                    tension: 0.3,
                    pointBackgroundColor: fczBlue,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Spieltag' }
                    },
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Punkte' }
                    }
                }
            }
        });

        // Win/Draw/Loss Pie Chart
        const resultsCtx = document.getElementById('resultsChart').getContext('2d');
        new Chart(resultsCtx, {
            type: 'doughnut',
            data: {
                labels: ['Siege', 'Unentschieden', 'Niederlagen'],
                datasets: [{
                    data: [{{ stats.won }}, {{ stats.drawn }}, {{ stats.lost }}],
                    backgroundColor: [successColor, warningColor, dangerColor],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Goals per Matchday Chart
        const goalsCtx = document.getElementById('goalsChart').getContext('2d');
        new Chart(goalsCtx, {
            type: 'bar',
            data: {
                labels: {{ range(1, (stats.goals_by_matchday.scored|length if stats.goals_by_matchday else 0) + 1)|list|tojson }},
                datasets: [{
                    label: 'Geschossen',
                    data: {{ stats.goals_by_matchday.scored|tojson if stats.goals_by_matchday else '[]' }},
                    backgroundColor: successColor,
                    borderRadius: 4
                }, {
                    label: 'Kassiert',
                    data: {{ stats.goals_by_matchday.conceded|tojson if stats.goals_by_matchday else '[]' }},
                    backgroundColor: dangerColor,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Spieltag' }
                    },
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Tore' }
                    }
                }
            }
        });

        // Home vs Away Points Chart
        const homeAwayCtx = document.getElementById('homeAwayChart').getContext('2d');
        new Chart(homeAwayCtx, {
            type: 'bar',
            data: {
                labels: ['Punkte', 'Siege', 'Tore', 'Gegentore'],
                datasets: [{
                    label: 'Heim',
                    data: [
                        {{ stats.home_stats.points if stats.home_stats else 0 }},
                        {{ stats.home_stats.won if stats.home_stats else 0 }},
                        {{ stats.home_stats.goals_for if stats.home_stats else 0 }},
                        {{ stats.home_stats.goals_against if stats.home_stats else 0 }}
                    ],
                    backgroundColor: fczBlue,
                    borderRadius: 4
                }, {
                    label: 'Ausw√§rts',
                    data: [
                        {{ stats.away_stats.points if stats.away_stats else 0 }},
                        {{ stats.away_stats.won if stats.away_stats else 0 }},
                        {{ stats.away_stats.goals_for if stats.away_stats else 0 }},
                        {{ stats.away_stats.goals_against if stats.away_stats else 0 }}
                    ],
                    backgroundColor: fczBlueDark,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</body>
</html>
